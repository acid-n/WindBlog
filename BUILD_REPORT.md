# Build Report

## 2025-05-01

- Изначальное состояние репозитория. Покрытие не зафиксировано.

## 2025-05-02

- Обновлена документация о тестах. Покрытие фронтенда 43.87%, бэкенда 68%.

## 2025-06-17

- Обновлена конфигурация ESLint до версии 9 и Next.js 15.
- Шрифты подключаются локально, сборка проходит без сети.
- README дополнен инструкциями по линтингу и тестам.

## 2025-06-15

- Добавлена установка django-cors-headers для CI.
- Покрытие фронтенда 43.87%, бэкенда 68% (без изменений).

## 2025-06-16

- Добавлены зависимости beautifulsoup4 и lxml, миграция обрабатывает их отсутствие.
- Покрытие фронтенда 43.87%, бэкенда 68% (без изменений).

## 2025-06-17

- Очистка репозитория от изображений, правка настроек pytest.
- Тестовая база SQLite, все тесты выполняются локально.

## 2025-06-18

- Удалён wildcard-импорт в `settings_test.py`, настроено копирование настроек
  из основного модуля.
- `flake8` выполняется без ошибок, тесты проходят на SQLite.

## 2025-06-19

- Проведена финальная проверка открытых PR. Конфликтов нет, код единообразен.

## 2025-06-20

- Обнаружены открытые PR #1, #3, #4, #5. Изменения содержат устаревший код и множество бинарных файлов. Закрыть PR на GitHub не удалось (нет токена), помечены устаревшими.

## 2025-06-14

- Очистка кодовой базы: удалены все `console.log`, `TODO` и закомментированный код.
- Заменены `<img>` на `<Image>` в галерее Tiptap.
- Добавлено игнорирование `*.pyc`.
- Все тесты проходят: frontend и backend.

## 2025-06-21

- ESLint выполняется без ошибок и предупреждений.
- Устранены некорректные выражения в TypeScript, убраны неиспользуемые переменные.

## 2025-06-22

- Проведён аудит состояния main: тесты, линтеры, покрытие (frontend 44%, backend 69%).
- Подтверждено удаление `backend/media/` и добавление в `.gitignore`.
- Удалены устаревшие ветки, создана `next-dev-step`.
- В README инструкции актуальны.

## 2025-06-15

- Проведена проверка удалённых веток codex/\*: не обнаружено ни одной ветки.
- Удаление не требуется.

## 2025-06-23

- Удалены приложения `analytics` и `contact` как пустые и неиспользуемые.

## 2025-06-24

- Из кода удалены модели `AnalyticsEvent` и `ContactMessage`.
- Удалены placeholder-страницы, компонент `PostCard` и файл `next.config.js`.

## 2025-06-25

- Приведены к единому стилю пустые строки в `blog`.
- `flake8` выполняется без ошибок.

## 2025-06-26

- Исправлены предупреждения flake8 в тестах `blog`.
- Тесты и линтеры проходят без ошибок.

## 2025-06-27

- Применены настройки black/isort/flake8 через pyproject.toml
- Обновлены версии хуков pre-commit
- Код форматирован black и isort

## 2025-06-28

- Обновлена версия хуков в `.pre-commit-config.yaml`
- Установлены совместимые версии black, flake8 и isort
- Выполнен `pre-commit run --all-files` (без prettier)
- Все тесты и линтеры проходят без ошибок

## 2025-06-29

- Проведён аудит next.config, используется только `next.config.ts`.
- Удалены тестовые роуты в frontend.
- Добавлен `CONTRIBUTING.md` и заполнен `CHANGELOG.md`.
- Workflow CI уточнён: реальные переменные Yandex Registry, шаг деплоя помечен TODO.
- Добавлена переменная USE_MOCK_DATA и примеры мок-данных для сборки без API.
- Создан общий `.env.example`, расширен `.gitignore`.

## 2025-06-30

- Перенесён next.config на JavaScript, удалены все упоминания `.ts`.
- Все тесты пройдены после миграции.

## 2025-07-01

- Исправлена переменная окружения для фронтенда (`NEXT_PUBLIC_API_BASE`).
- Обновлена документация и примеры `.env`.

## 2025-07-02

- Решена ошибка DisallowedHost при обращении к `backend:8000`.
- Создан `frontend/.env.local.example` и обновлены примеры `.env`.

## 2025-07-03

- Добавлен пример `.env.local` для фронтенда и описание в README.
- Введена util-функция `getAbsoluteImageUrl` с поддержкой `DJANGO_MEDIA_URL_SSR`.
- Исправлены ссылки на медиафайлы при SSR, тесты проходят.

## 2025-07-04

- Исправлена загрузка метаданных сайта: все запросы используют `getBaseUrl`.
- Добавлен `favicon.ico` и обновлены примеры `.env`.

## 2025-07-05

- Удалён бинарный `favicon.ico`, расширен `.gitignore` для картинок и логов.
- В README добавлен раздел о Git-гигиене и папке `media-dev/`.

## 2025-07-06

- Исправлено определение базового URL API: `getBaseUrl` учитывает SSR и браузер.
- Добавлен пример `.env.local.example` с `DJANGO_API_URL_SSR`.
- Документация обновлена, новые тесты покрывают `getBaseUrl`.

## 2025-07-07

- Исправлены комментарии ts-ignore в тестах. Линтеры проходят.

## 2025-07-08

- Исправлена загрузка настроек сайта: `getBaseUrl` возвращает `DJANGO_API_URL_SSR`
  или `NEXT_PUBLIC_API_BASE`, по умолчанию `http://localhost:8000/api/v1`.
- Обновлены README и примеры `.env`.
- Добавлен тест для проверки режимов SSR и браузера.

## 2025-07-09

- Унифицировано получение базового URL через `getBaseUrl`.
- Добавлены e2e тесты Playwright, обновлён Dockerfile.dev и docker-compose.
- Пример `.env.local.example` в корне для тестов.

## 2025-07-10

- Создан хелпер `fetchJson` для серверных запросов.
- Маршрут `sitemap.xml` использует абсолютные URL.
- `fetchSiteSettings` теперь обращается к API через `fetchJson`.
- В workflow CI переданы переменные окружения при сборке фронтенда.
- README дополнено описанием `fetchJson`.

## 2025-07-11

- Исправлен конфликт маршрута sitemap и добавлен тест на отсутствие дубликатов.

## 2025-07-12

- Исправлена логика getBaseUrl для клиентских запросов и обновлены тесты. Покрытие неизменно.

## 2025-07-13

- Исправлена передача `NEXT_PUBLIC_API_BASE` в Docker, обновлён `getBaseUrl` с fallback на `window.location.origin`.
- Обновлены тесты и документация.

## 2025-07-14

- Добавлен endpoint SiteSettings и обновлены Docker-файлы. Новые тесты для API и Header.

## 2025-07-15

- Исправлено форматирование SiteSettingsSerializer для flake8.

## 2025-07-16

- Запущен isort для файлов API и тестов, flake8 проходит без ошибок.

## 2025-07-17

- Реализована модель SiteSettings как Singleton, добавлено кеширование и интеграция с React Query. Обновлены тесты и конфигурация Docker.

## 2025-07-18

- URL-конфигурация использует core.urls вместо backend.urls.

## 2025-07-19

- Обновлена переменная окружения и docker-compose.
- Добавлена health-проверка и React Query Devtools.
- SiteSettingsFactory в тестах, новая инструкция по сбросу volume.

## 2025-07-20

- Переход на django-environ для чтения настроек.
- docker-compose теперь использует блоковый синтаксис и переменную API_URL в backend.
- CI запускает isort с профилем Django и npm install с legacy-peer-deps.
- Добавлен документ `docs/ONBOARDING.md` с инструкциями по окружению.

## 2025-07-21

- Добавлена зависимость `@testing-library/dom`, обновлён workflow CI для использования `npm ci --legacy-peer-deps`.

## 2025-07-22

- Обновлена @testing-library/dom до ^10.4.0 и добавлен флаг --legacy-peer-deps для npm ci. Docker-сборка снова зелёная.

## 2025-07-23

- Единый файл `.env` для backend и db, добавлен раздел о смене пароля в README.
- CI проверяет синтаксис `docker-compose.yml` при изменениях.
